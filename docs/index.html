<!DOCTYPE html>
<!-- VERSION 5.3 - Jan 15, 2026 16:40 CET - Edit button + Daily reset -->
<!-- ‚úÖ Pure ASCII, All tasks visible, Subtasks, Edit tasks, Daily NON-NEGOTIABLES reset -->
<html lang="en"><!-- v6.0 Jan 22 02:15 CACHE BUST -->
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="theme-color" content="#667eea">
    <link rel="manifest" href="manifest.json">
    <title>Sarah's TODO</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; -webkit-tap-highlight-color: transparent; }
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 15px;
            font-size: 16px;
        }
        .container {
            max-width: 800px;
            margin: 0 auto;
            background: white;
            border-radius: 15px;
            box-shadow: 0 10px 40px rgba(0,0,0,0.3);
            padding: 20px;
        }
        .header {
            text-align: center;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 2px solid #667eea;
        }
        h1 { color: #667eea; font-size: 1.8em; margin-bottom: 5px; }
        .sync-status {
            background: #48bb78;
            color: white;
            padding: 8px 15px;
            border-radius: 6px;
            display: inline-block;
            margin-top: 8px;
            font-weight: 600;
            font-size: 0.9em;
        }
        .sync-status.pending { background: #ed8936; }
        .sync-status.syncing { background: #4299e1; }
        .setup-modal {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0,0,0,0.8);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 3000;
            padding: 20px;
        }
        .setup-modal.hidden { display: none; }
        .setup-content {
            background: white;
            border-radius: 15px;
            padding: 25px;
            max-width: 500px;
            width: 100%;
        }
        .setup-content h2 {
            color: #667eea;
            margin-bottom: 15px;
        }
        .setup-content p {
            margin-bottom: 15px;
            line-height: 1.5;
        }
        .setup-content input {
            width: 100%;
            padding: 12px;
            border: 2px solid #e2e8f0;
            border-radius: 8px;
            font-size: 14px;
            margin-bottom: 15px;
            font-family: monospace;
        }
        .setup-content input:focus {
            outline: none;
            border-color: #667eea;
        }
        .setup-content button {
            width: 100%;
            padding: 12px;
            background: #667eea;
            color: white;
            border: none;
            border-radius: 8px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
        }
        .github-box {
            background: #e6f7ff;
            border: 2px solid #4299e1;
            border-radius: 10px;
            padding: 15px;
            margin-bottom: 20px;
        }
        .github-box h3 { color: #2c5aa0; margin-bottom: 12px; font-size: 1.1em; text-align: center; }
        .github-buttons {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
        }
        button {
            padding: 12px 20px;
            border: none;
            border-radius: 8px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
            touch-action: manipulation;
        }
        .btn-github-pull {
            background: linear-gradient(135deg, #48bb78 0%, #38a169 100%);
            color: white;
            font-size: 15px;
            padding: 12px 15px;
        }
        .btn-github-push {
            background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
            color: white;
            font-size: 15px;
            padding: 12px 15px;
        }
        .btn-github-pull:active, .btn-github-push:active { transform: scale(0.98); }
        .btn-settings {
            background: #718096;
            color: white;
            font-size: 14px;
            padding: 8px 15px;
            float: right;
        }
        .controls {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 10px;
            margin-bottom: 20px;
        }
        .btn-secondary { background: #48bb78; color: white; font-size: 14px; padding: 10px; }
        .btn-danger { background: #f56565; color: white; font-size: 14px; padding: 10px; }
        .btn-primary { background: #667eea; color: white; }
        .stats {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 10px;
            margin-bottom: 20px;
        }
        .stat-card {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 15px;
            border-radius: 10px;
            text-align: center;
        }
        .stat-card h3 { font-size: 1.8em; margin-bottom: 3px; }
        .stat-card p { opacity: 0.9; font-size: 0.85em; }
        .section {
            margin-bottom: 20px;
            border: 2px solid #e2e8f0;
            border-radius: 10px;
            overflow: hidden;
        }
        .section-header {
            background: #f7fafc;
            padding: 12px 15px;
            cursor: pointer;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        .section-header h2 {
            color: #2d3748;
            font-size: 1.1em;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        .section-badge {
            background: #667eea;
            color: white;
            padding: 3px 10px;
            border-radius: 15px;
            font-size: 0.8em;
        }
        .section-content { padding: 15px; }
        .section-content.collapsed { display: none; }
        .task {
            display: flex;
            align-items: flex-start;
            gap: 10px;
            padding: 10px;
            margin-bottom: 8px;
            border-radius: 6px;
        }
        .task.completed { opacity: 0.6; }
        .task.completed .task-text { text-decoration: line-through; color: #a0aec0; }
        .task input[type="checkbox"] {
            width: 22px;
            height: 22px;
            cursor: pointer;
            margin-top: 2px;
            flex-shrink: 0;
        }
        .task-text { flex: 1; line-height: 1.5; color: #2d3748; font-size: 0.95em; }
        .load-more {
            text-align: center;
            padding: 15px;
            background: #f7fafc;
            border-radius: 8px;
            margin: 15px 0;
        }
        .load-more button {
            background: #667eea;
            color: white;
            padding: 10px 20px;
        }
        .toast {
            position: fixed;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%);
            background: #2d3748;
            color: white;
            padding: 12px 20px;
            border-radius: 8px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.3);
            z-index: 2000;
            display: none;
            font-size: 0.9em;
            max-width: 90%;
        }
        .toast.active { display: block; animation: slideUp 0.3s; }
        @keyframes slideUp {
            from { transform: translate(-50%, 100px); opacity: 0; }
            to { transform: translate(-50%, 0); opacity: 1; }
        }
        .btn-delete {
            background: none;
            border: none;
            font-size: 18px;
            cursor: pointer;
            padding: 5px;
            margin-left: auto;
            opacity: 0.5;
            transition: opacity 0.2s;
        }
        
        .btn-delete:hover {
            opacity: 1;
        }
        
        .btn-edit {
            background: transparent;
            border: none;
            color: #cbd5e0;
            cursor: pointer;
            font-size: 18px;
            padding: 2px 6px;
            margin-left: auto;
            margin-right: 5px;
            opacity: 0.5;
            transition: opacity 0.2s, color 0.2s;
        }
        
        .btn-edit:hover {
            opacity: 1;
            color: #667eea;
        }
        
        .btn-add-subtask {
            background: transparent;
            border: 1px solid #667eea;
            color: #667eea;
            padding: 4px 10px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 500;
            margin-right: 5px;
            opacity: 0.6;
            transition: opacity 0.2s, background 0.2s;
        }
        
        .btn-add-subtask:hover {
            opacity: 1;
            background: #f7fafc;
        }
        
        .subtasks {
            width: calc(100% - 30px);
            max-width: 100%;
            margin: 12px 0 0 10px;
            padding: 8px;
            border-left: 3px solid #9f7aea;
            background: #f7fafc;
            border-radius: 0 6px 6px 0;
            box-sizing: border-box;
            overflow: visible;
        }
        
        .subtask {
            display: flex;
            align-items: center;
            gap: 6px;
            padding: 8px;
            font-size: 0.92em;
            background: white;
            margin: 6px 0;
            border-radius: 4px;
            border: 1px solid #e2e8f0;
            min-height: 44px;
            box-sizing: border-box;
            max-width: 100%;
            width: 100%;
        }
        
        .subtask.completed {
            background: #f7fafc;
            opacity: 0.7;
        }
        
        .subtask.completed .subtask-text {
            text-decoration: line-through;
            color: #a0aec0;
        }
        
        .subtask input[type="checkbox"] {
            width: 18px;
            height: 18px;
            cursor: pointer;
            flex-shrink: 0;
        }
        
        .subtask-text {
            flex: 1;
            color: #2d3748;
            line-height: 1.4;
            word-wrap: break-word;
            overflow-wrap: break-word;
            max-width: 100%;
            min-width: 0;
        }
        
        .btn-edit-sub {
            background: transparent;
            border: none;
            cursor: pointer;
            font-size: 1.1em;
            padding: 4px 8px;
            border-radius: 4px;
            transition: all 0.2s;
            color: #718096;
            flex-shrink: 0;
        }
        
        .btn-edit-sub:hover {
            background: #edf2f7;
            color: #805ad5;
        }
        
        .btn-delete-sub {
            background: transparent;
            border: none;
            color: #cbd5e0;
            cursor: pointer;
            font-size: 16px;
            padding: 2px 6px;
            opacity: 0.5;
            transition: opacity 0.2s, color 0.2s;
        }
        
        .btn-delete-sub:hover {
            opacity: 1;
            color: #f56565;
        }
        
        .add-task-row {
            margin-top: 10px;
            padding-top: 10px;
            border-top: 1px solid #e0e0e0;
        }
        
        .btn-add-task {
            width: 100%;
            padding: 12px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 500;
            transition: transform 0.2s, box-shadow 0.2s;
        }
        
        .btn-add-task:hover {
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(102, 126, 234, 0.4);
        }
        
        .btn-add-task:active {
            transform: translateY(0);
        }
    </style>
</head>
<body>
    <div class="setup-modal hidden" id="setupModal">
        <div class="setup-content">
            <h2>üîë Setup GitHub Sync</h2>
            <p>Enter your GitHub token (saved to 3 storage locations!):</p>
            <input type="password" id="tokenInput" placeholder="ghp_...">
            <button onclick="app.saveToken()">üíæ Save Token</button>
            <p style="font-size: 0.85em; color: #666; margin-top: 10px;">Token stored locally in: localStorage + sessionStorage + cookies</p>
        </div>
    </div>
    
    <div class="container">
        <div class="header">
            <button class="btn-settings" onclick="app.showSetup()">‚öôÔ∏è Settings</button>
            <h1>Sarah's TODO</h1>
            <p style="font-size: 0.75em; color: #999; margin-top: -5px;">v5.3 - Jan 15, 16:40 - Edit + Daily Reset!</p>
            <p style="font-size: 0.9em; color: #666;">ADHD-Friendly Manager</p>
            <div class="sync-status" id="syncStatus">Synced</div>
        </div>
        
        <div class="github-box">
            <h3>GITHUB SYNC</h3>
            <div class="github-buttons">
                <button class="btn-github-pull" onclick="app.pullFromGitHub()">Pull Latest</button>
                <button class="btn-github-push" onclick="app.pushToGitHub()">Push Changes</button>
            </div>
            <p style="font-size: 0.85em; color: #666; margin-top: 12px; text-align: center;">Pull: Get new tasks | Push: Save progress</p>
        </div>
        
        <div class="controls">
            <button class="btn-secondary" onclick="app.undo()">Undo</button>
            <button class="btn-secondary" onclick="app.collapseAll()">Collapse</button>
            <button class="btn-secondary" onclick="app.expandAll()">Expand</button>
            <button class="btn-danger" onclick="app.clearCompleted()">Clear Done</button>
        </div>
        
        <div class="stats">
            <div class="stat-card"><h3 id="totalTasks">0</h3><p>Total</p></div>
            <div class="stat-card"><h3 id="completedTasks">0</h3><p>Done</p></div>
            <div class="stat-card"><h3 id="remainingTasks">0</h3><p>Left</p></div>
            <div class="stat-card"><h3 id="progressPercent">0%</h3><p>Progress</p></div>
        </div>
        
        <div id="sections"></div>
    </div>
    
    <div class="toast" id="toast"></div>
    
    <script>
        const INITIAL_DATA = [{"id": "daily", "title": "*** üåÖ √∞¬ü¬å¬Ö DAILY NON-NEGOTIABLES", "collapsed": false, "tasks": [{"id": 1, "text": "Basic back hygiene (James routine) - 3 exercises", "completed": false, "subtasks": []}, {"id": 2, "text": "Drink water - Stay hydrated", "completed": false, "subtasks": []}, {"id": 3, "text": "Meu's meds - AMODIP + BENEFORTIL + CYSTAID", "completed": false, "subtasks": []}, {"id": 4, "text": "Concerta 36mg - Take on waking", "completed": false, "subtasks": []}]}, {"id": "urgent-bcn", "title": "[!] üî¥ √∞¬ü¬î¬¥ URGENT - As Soon as Back in Barcelona", "collapsed": false, "tasks": [{"id": 5, "text": "FIND THE TO GO BAG AND HAVE IT READY", "completed": false, "subtasks": []}, {"id": 6, "text": "Material survival on Remarkable and paper plastificato (make list)", "completed": false, "subtasks": []}, {"id": 7, "text": "PREPARE EXIT STRATEGY with Yakir and Laza", "completed": false, "subtasks": []}, {"id": 8, "text": "Calculate expenses to be paid back from legal case", "completed": false, "subtasks": []}]}, {"id": "urgent-health", "title": "[+] üè• √∞¬ü¬è¬• URGENT - Health & Medical", "collapsed": true, "tasks": [{"id": 9, "text": "Reprogramar cirug√É¬≠a Neo - Reschedule Neo's surgery", "completed": false, "subtasks": []}, {"id": 10, "text": "Programar examen mioma - Find gynecologist Sanitas for exam", "completed": false, "subtasks": []}, {"id": 11, "text": "Get appointments: James & Daniel - Physio sessions needed", "completed": false, "subtasks": []}, {"id": 12, "text": "NEW QUETIAPINA in CAT SALUT - Send message to medico", "completed": false, "subtasks": []}, {"id": 13, "text": "Cita Cap Montigala + pedir cita con: Traumatologo, Neurocirujano, Physiotherapeuta, Ginecologa", "completed": false, "subtasks": []}, {"id": 14, "text": "Get teeth cleaning appointment with Sanitas", "completed": false, "subtasks": []}, {"id": 15, "text": "Call dentist for moving tooth", "completed": false, "subtasks": []}]}, {"id": "urgent-admin", "title": "[$] üìã √∞¬ü¬ì¬ã URGENT - Admin/Financial", "collapsed": true, "tasks": [{"id": 16, "text": "READ EMAILS FROM SEG.SOCIAL", "completed": false, "subtasks": []}, {"id": 17, "text": "READ BILLS", "completed": false, "subtasks": []}, {"id": 18, "text": "Create new tally after Notary papers (UPDATED NUMBERS) - Post-Dec 11 signing", "completed": false, "subtasks": []}, {"id": 19, "text": "Follow up Oriol about Mutua and pension", "completed": false, "subtasks": []}, {"id": 20, "text": "Update on Oriol and my baja mgmt (read emails)", "completed": false, "subtasks": []}, {"id": 21, "text": "Read Monica's email - Legal case", "completed": false, "subtasks": []}, {"id": 22, "text": "Coordinate witness testimonies - Martino URGENT before share sale", "completed": false, "subtasks": []}, {"id": 23, "text": "Check herbolary books tracking", "completed": false, "subtasks": []}]}, {"id": "teatro-urgent", "title": "[T] üé≠ √∞¬ü¬é¬≠ TEATRO - Urgent/Active", "collapsed": true, "tasks": [{"id": 24, "text": "Finish event process with Barry White (Feb 7, 80√¢¬Ç¬¨/hr, venue mgmt, bar, cava, food on demand)", "completed": false, "subtasks": []}, {"id": 25, "text": "Get invoices from Oriol for Laura", "completed": false, "subtasks": []}, {"id": 26, "text": "Pagare facturas fringe (check with Laura)", "completed": false, "subtasks": []}, {"id": 27, "text": "Follow up on management transfer documentation", "completed": false, "subtasks": []}]}, {"id": "teatro-money", "title": "[$$] üí∞ √∞¬ü¬í¬∞ TEATRO - Money Owed/Payments", "collapsed": true, "tasks": [{"id": 28, "text": "MONEY FROM MALNOM? 900√¢¬Ç¬¨ - 100√¢¬Ç¬¨ Ruy - 250√¢¬Ç¬¨ Teatro - 300√¢¬Ç¬¨ Gas/Vitro = 250√¢¬Ç¬¨ for me?", "completed": false, "subtasks": []}, {"id": 29, "text": "YAKIR debts: SOLDI TEATRO Give back 310√¢¬Ç¬¨", "completed": false, "subtasks": []}, {"id": 30, "text": "YAKIR debts: Soldi green Give back 200√¢¬Ç¬¨", "completed": false, "subtasks": []}, {"id": 31, "text": "SOLDI PER CHRISTIAN PER OLIO: 70√¢¬Ç¬¨", "completed": false, "subtasks": []}, {"id": 32, "text": "CUENTAS: RAFA tally", "completed": false, "subtasks": []}, {"id": 33, "text": "CUENTAS: ALE (received 100√¢¬Ç¬¨ through Bernardo, January 2026)", "completed": false, "subtasks": []}, {"id": 34, "text": "CUENTAS: NEW TALLY FERGIE", "completed": false, "subtasks": []}]}, {"id": "malnom", "title": "[H] üè† √∞¬ü¬è¬† MALNOM - Property", "collapsed": true, "tasks": [{"id": 35, "text": "FOLLOW UP: pared malnom - A que punto estamos con la finca a lado?", "completed": false, "subtasks": []}, {"id": 36, "text": "Follow up: contrato CUIDA CALEFACCION", "completed": false, "subtasks": []}, {"id": 37, "text": "Follow up: mantenimento gas in Malnom", "completed": false, "subtasks": []}]}, {"id": "valencia", "title": "[V] üá™üá∏ √∞¬ü¬á¬™√∞¬ü¬á¬∏ VALENCIA - Dad & House", "collapsed": true, "tasks": [{"id": 38, "text": "DIGI - activaci√É¬≥n eSIM per dad", "completed": false, "subtasks": []}, {"id": 39, "text": "Follow up on Dependencia (letter to arrive end of February)", "completed": false, "subtasks": []}, {"id": 40, "text": "Follow up AYUDA SUMINISTRO OXYGENO (registered January 9)", "completed": false, "subtasks": []}, {"id": 41, "text": "Follow up DENNYS: Money from Ayto, Quote for works, Permits and timings", "completed": false, "subtasks": []}, {"id": 42, "text": "Follow up Andreu (to split cost mesa a terra)", "completed": false, "subtasks": []}, {"id": 43, "text": "Dad videocall Belgium pension office - Feb 12 at 10am (code: 91239568, hotmail.it)", "completed": false, "subtasks": []}, {"id": 44, "text": "Call LINEA DIRECTA (919 180 012, 09:00-18:00) - kitchen leak, Exp: 15600223", "completed": false, "subtasks": []}, {"id": 45, "text": "BOMBONAS GAS Valencia (963956006)", "completed": false, "subtasks": []}]}, {"id": "zio-vittorio", "title": "[Z] üèóÔ∏è √∞¬ü¬è¬ó√Ø¬∏¬è ZIO VITTORIO - Property Purchase", "collapsed": true, "tasks": [{"id": 46, "text": "PREPARA BUDGET PLAN PER ZIO VIC (in francese o italiano)", "completed": false, "subtasks": []}, {"id": 47, "text": "Calculate 2-year taxi costs (teatro late nights √¢¬Ü¬í Can Booty)", "completed": false, "subtasks": []}, {"id": 48, "text": "Research house for Vic - See ZIO_VITTORIO.md for complete analysis", "completed": false, "subtasks": []}, {"id": 49, "text": "Check details: Unipersonal vs S.L. - Pro/Con regarding property purchase", "completed": false, "subtasks": []}]}, {"id": "admin-insurance", "title": "[A] üìã √∞¬ü¬ì¬ã ADMIN - Insurance & Services", "collapsed": true, "tasks": [{"id": 50, "text": "Check my actual polizas seguro", "completed": false, "subtasks": []}, {"id": 51, "text": "Find new options with better service and lower cost", "completed": false, "subtasks": []}, {"id": 52, "text": "FIND POLIZAS WITH MANTENIMIENTO", "completed": false, "subtasks": []}, {"id": 53, "text": "Change payment details in Workspace - New tarjeta Santander", "completed": false, "subtasks": []}]}, {"id": "to-sell", "title": "[S] üí∏ √∞¬ü¬í¬∏ TO SELL", "collapsed": true, "tasks": [{"id": 54, "text": "VESPA", "completed": false, "subtasks": []}, {"id": 55, "text": "RINO??", "completed": false, "subtasks": []}, {"id": 56, "text": "MOTO", "completed": false, "subtasks": []}]}, {"id": "italy", "title": "[I] üáÆüáπ √∞¬ü¬á¬Æ√∞¬ü¬á¬π ITALY - Personal Admin", "collapsed": true, "tasks": [{"id": 57, "text": "ORGANIZZA VIAGGIO A ROMA: Per cambio domicilio e nuova carta identit√É", "completed": false, "subtasks": []}, {"id": 58, "text": "Check my calendar for availability", "completed": false, "subtasks": []}, {"id": 59, "text": "Check flights", "completed": false, "subtasks": []}, {"id": 60, "text": "Check in with Diego for availability", "completed": false, "subtasks": []}, {"id": 61, "text": "Find info from Comune di Roma", "completed": false, "subtasks": []}]}, {"id": "cartas", "title": "[C] üé® √∞¬ü¬é¬® CARTAS EN VIVO", "collapsed": true, "tasks": [{"id": 62, "text": "Riprendere lavoro su Letters Live - Resume work", "completed": false, "subtasks": []}, {"id": 63, "text": "Research Letters Live UK format more deeply", "completed": false, "subtasks": []}, {"id": 64, "text": "Build celebrity contact list for readers", "completed": false, "subtasks": []}, {"id": 65, "text": "Plan Goya Awards timing strategy (Feb 28, 2026)", "completed": false, "subtasks": []}, {"id": 66, "text": "Organize massive research done (Nov 26-27)", "completed": false, "subtasks": []}, {"id": 67, "text": "Create roadmap with M", "completed": false, "subtasks": []}, {"id": 68, "text": "Devil's advocate strategy session", "completed": false, "subtasks": []}]}, {"id": "tech", "title": "[>] üíª √∞¬ü¬í¬ª TECH & SYSTEMS", "collapsed": true, "tasks": [{"id": 69, "text": "FOR CODY: Fix morning brief automation (currently failing)", "completed": false, "subtasks": []}, {"id": 70, "text": "FOR CODY: Fix news digest automation (currently failing)", "completed": false, "subtasks": []}, {"id": 71, "text": "FOR CODY: Create multiple email reading automation on GitHub (for M to fetch)", "completed": false, "subtasks": []}, {"id": 72, "text": "Learn GitHub workflow from Pilot's guides", "completed": false, "subtasks": []}, {"id": 73, "text": "Set up automatic backup system", "completed": false, "subtasks": []}, {"id": 74, "text": "Find system that chats with multiple AI at same time (see Yakir's notes)", "completed": false, "subtasks": []}, {"id": 75, "text": "What's Substack? Can I add it to my daily digest news? How does it work?", "completed": false, "subtasks": []}, {"id": 76, "text": "Tell M to check new Claude extensions - what can she do now? (Ex: parse legal case data?)", "completed": false, "subtasks": []}]}, {"id": "learning", "title": "[L] üìö √∞¬ü¬ì¬ö LEARNING", "collapsed": true, "tasks": [{"id": 77, "text": "Read Pilot's GitHub guides", "completed": false, "subtasks": []}, {"id": 78, "text": "Review Claude Code documentation", "completed": false, "subtasks": []}]}, {"id": "home", "title": "[~] üè° √∞¬ü¬è¬° HOME & PERSONAL", "collapsed": true, "tasks": [{"id": 79, "text": "Research synagogue visits (family heritage exploration)", "completed": false, "subtasks": []}, {"id": 80, "text": "Text Andreu - Share AirCon costs (STILL PENDING from November!)", "completed": false, "subtasks": []}, {"id": 81, "text": "Work on LinkedIn profile", "completed": false, "subtasks": []}, {"id": 82, "text": "Find DISCORD support ADHD community!!! (and what else does Discord do?)", "completed": false, "subtasks": []}]}, {"id": "attico", "title": "[B] üèóÔ∏è √∞¬ü¬è¬ó√Ø¬∏¬è ATTICO WORKS", "collapsed": true, "tasks": [{"id": 83, "text": "Trova stoffe utilizzabili per tende: Ask Malaka/Charlie for spare fabric", "completed": false, "subtasks": []}, {"id": 84, "text": "Find spray to make fabric ignifugo (fireproof spray)", "completed": false, "subtasks": []}]}, {"id": "legal", "title": "[LAW] ‚öñÔ∏è √¢¬ö¬ñ√Ø¬∏¬è LEGAL", "collapsed": true, "tasks": [{"id": 85, "text": "Review legal evidence timeline with attorney Monica", "completed": false, "subtasks": []}, {"id": 86, "text": "Coordinate witness testimonies (Martino - URGENT before share sale)", "completed": false, "subtasks": []}, {"id": 87, "text": "Calculate expenses to be paid back from legal case", "completed": false, "subtasks": []}]}];
        const GITHUB_REPO = "MotherOfChaos/Life-Operating-System";
        const GITHUB_FILE = "PERMANENT_TODO.md";
        
        const app = {
            data: { sections: [], history: [], hasUnsyncedChanges: false, pagination: {}, lastSHA: null },
            TASKS_PER_PAGE: 9999, // Show ALL tasks - no pagination!
            
            async init() {
                // Check token from ALL storage types
                const token = this.getToken();
                if (!token) {
                    document.getElementById('setupModal').classList.remove('hidden');
                    return;
                }
                
                await this.loadData();
                this.render();
                this.updateStats();
                this.updateSyncStatus();
            },
            
            saveToken() {
                const token = document.getElementById('tokenInput').value.trim();
                if (!token || !token.startsWith('ghp_')) {
                    alert('‚ö†Ô∏è Please enter a valid GitHub token starting with ghp_');
                    return;
                }
                
                // TRIPLE STORAGE - save to all 3 locations!
                try {
                    localStorage.setItem('github-token', token);
                    sessionStorage.setItem('github-token', token);
                    this.setCookie('github-token', token, 365);
                    
                    alert('‚úÖ Token saved to 3 storage locations!');
                    document.getElementById('setupModal').classList.add('hidden');
                    this.init();
                } catch (e) {
                    alert('‚ùå Error saving token: ' + e.message);
                }
            },
            
            setCookie(name, value, days) {
                const expires = new Date(Date.now() + days * 864e5).toUTCString();
                document.cookie = name + '=' + encodeURIComponent(value) + '; expires=' + expires + '; path=/; SameSite=Strict';
            },
            
            getCookie(name) {
                return document.cookie.split('; ').reduce((r, v) => {
                    const parts = v.split('=');
                    return parts[0] === name ? decodeURIComponent(parts[1]) : r;
                }, '');
            },
            
            showSetup() {
                const token = this.getToken() || '';
                document.getElementById('tokenInput').value = token;
                document.getElementById('setupModal').classList.remove('hidden');
            },
            
            getToken() {
                // Try ALL storage locations
                return localStorage.getItem('github-token') ||
                       sessionStorage.getItem('github-token') ||
                       this.getCookie('github-token');
            },
            
            async pullFromGitHub() {
                const token = this.getToken();
                if (!token) { 
                    alert('‚ö†Ô∏è Please set up your GitHub token first!');
                    this.showSetup(); 
                    return; 
                }
                
                const status = document.getElementById('syncStatus');
                status.textContent = 'Pulling...';
                status.className = 'sync-status syncing';
                
                try {
                    const url = `https://api.github.com/repos/${GITHUB_REPO}/contents/${GITHUB_FILE}`;
                    const response = await fetch(url, {
                        headers: {
                            'Authorization': `token ${token}`,
                            'Accept': 'application/vnd.github.v3+json'
                        }
                    });
                    
                    if (!response.ok) throw new Error('Failed');
                    
                    const data = await response.json();
                    this.data.lastSHA = data.sha;
                    const markdown = atob(data.content);
                    const newSections = this.parseMarkdown(markdown);
                    this.mergeGitHubData(newSections);
                    await this.saveData();
                    this.render();
                    this.updateStats();
                    this.showToast('Pulled from GitHub!');
                    status.textContent = 'Synced';
                    status.className = 'sync-status';
                } catch (error) {
                    this.showToast('Pull failed');
                    status.textContent = 'Failed';
                    status.className = 'sync-status pending';
                }
            },
            
            async pushToGitHub() {
                const token = this.getToken();
                if (!token) { 
                    alert('‚ö†Ô∏è Please set up your GitHub token first!');
                    this.showSetup(); 
                    return; 
                }
                
                const status = document.getElementById('syncStatus');
                status.textContent = 'Pushing...';
                status.className = 'sync-status syncing';
                
                try {
                    if (!this.data.lastSHA) {
                        const getUrl = `https://api.github.com/repos/${GITHUB_REPO}/contents/${GITHUB_FILE}`;
                        const getResponse = await fetch(getUrl, {
                            headers: { 'Authorization': `token ${token}`, 'Accept': 'application/vnd.github.v3+json' }
                        });
                        if (getResponse.ok) {
                            const getData = await getResponse.json();
                            this.data.lastSHA = getData.sha;
                        }
                    }
                    
                    const markdown = this.generateTODOMarkdown();
                    const encodedContent = btoa(unescape(encodeURIComponent(markdown)));
                    const putUrl = `https://api.github.com/repos/${GITHUB_REPO}/contents/${GITHUB_FILE}`;
                    const putResponse = await fetch(putUrl, {
                        method: 'PUT',
                        headers: {
                            'Authorization': `token ${token}`,
                            'Accept': 'application/vnd.github.v3+json',
                            'Content-Type': 'application/json'
                        },
                        body: JSON.stringify({
                            message: `TODO update - ${new Date().toLocaleString()}`,
                            content: encodedContent,
                            sha: this.data.lastSHA
                        })
                    });
                    
                    if (!putResponse.ok) throw new Error('Failed');
                    
                    const putData = await putResponse.json();
                    this.data.lastSHA = putData.content.sha;
                    this.data.hasUnsyncedChanges = false;
                    await this.saveData();
                    this.showToast('Pushed to GitHub!');
                    status.textContent = 'Synced';
                    status.className = 'sync-status';
                } catch (error) {
                    this.showToast('Push failed');
                    status.textContent = 'Failed';
                    status.className = 'sync-status pending';
                }
            },
            
            parseMarkdown(md) {
                const sections = [];
                const lines = md.split('\n');
                let currentSection = null;
                let currentTask = null;
                let taskId = 1;
                
                // Helper function to clean task text
                const cleanText = (text) => {
                    // Strip markdown bold ** markers
                    text = text.replace(/\*\*/g, '');
                    // Strip other markdown like __ bold
                    text = text.replace(/__/g, '');
                    // Clean up extra whitespace
                    text = text.trim();
                    return text;
                };
                
                for (let line of lines) {
                    const trimmed = line.trim();
                    
                    // Section header
                    if (trimmed.startsWith('## ')) {
                        if (currentSection && currentSection.tasks.length > 0) sections.push(currentSection);
                        const title = trimmed.substring(3).trim();
                        currentSection = { id: 'section-' + sections.length, title: title, collapsed: false, tasks: [] };
                        currentTask = null;
                    }
                    // Main task (no indentation)
                    else if (trimmed.match(/^- \[(x| )\] /) && currentSection) {
                        const completed = trimmed.includes('[x]');
                        let text = trimmed.substring(6).trim();
                        text = cleanText(text);
                        currentTask = { id: taskId++, text: text, completed: completed, subtasks: [] };
                        currentSection.tasks.push(currentTask);
                    }
                    // Subtask (indented with 2+ spaces)
                    else if (line.match(/^  +- \[(x| )\] /) && currentTask) {
                        const completed = trimmed.includes('[x]');
                        let text = trimmed.substring(6).trim();
                        text = cleanText(text);
                        currentTask.subtasks.push({ id: taskId++, text: text, completed: completed });
                    }
                }
                if (currentSection && currentSection.tasks.length > 0) sections.push(currentSection);
                return sections;
            },
            
            mergeGitHubData(newSections) {
                const currentTaskStates = new Map();
                this.data.sections.forEach(section => {
                    section.tasks.forEach(task => {
                        currentTaskStates.set(task.text.toLowerCase(), { completed: task.completed });
                    });
                });
                
                newSections.forEach(section => {
                    section.tasks.forEach(task => {
                        const savedState = currentTaskStates.get(task.text.toLowerCase());
                        if (savedState) task.completed = savedState.completed;
                    });
                });
                
                this.data.sections = newSections;
                this.data.pagination = {};
                newSections.forEach(s => { this.data.pagination[s.id] = { page: 1 }; });
            },
            
            async loadData() {
                const stored = localStorage.getItem('sarah-todo-data');
                if (stored) {
                    this.data = JSON.parse(stored);
                    if (!this.data.pagination) this.data.pagination = {};
                    if (!this.data.lastSHA) this.data.lastSHA = null;
                    if (!this.data.lastResetDate) this.data.lastResetDate = null;
                    
                    // DAILY RESET for NON-NEGOTIABLES
                    const today = new Date().toDateString();
                    if (this.data.lastResetDate !== today) {
                        // Find DAILY NON-NEGOTIABLES section
                        const dailySection = this.data.sections.find(s => 
                            s.title.includes('DAILY') || s.title.includes('NON-NEGOTIABLES')
                        );
                        
                        if (dailySection) {
                            // Reset all tasks to unchecked
                            dailySection.tasks.forEach(task => {
                                task.completed = false;
                                // Also reset subtasks if any
                                if (task.subtasks) {
                                    task.subtasks.forEach(sub => sub.completed = false);
                                }
                            });
                            console.log('‚úÖ Daily tasks reset!');
                        }
                        
                        this.data.lastResetDate = today;
                        await this.saveData();
                    }
                } else {
                    this.data.sections = INITIAL_DATA;
                    this.data.history = [];
                    this.data.hasUnsyncedChanges = false;
                    this.data.pagination = {};
                    this.data.lastSHA = null;
                    this.data.lastResetDate = new Date().toDateString();
                    INITIAL_DATA.forEach(s => { this.data.pagination[s.id] = { page: 1 }; });
                }
            },
            
            async saveData() {
                this.data.hasUnsyncedChanges = true;
                localStorage.setItem('sarah-todo-data', JSON.stringify(this.data));
                this.updateSyncStatus();
            },
            
            updateSyncStatus() {
                const status = document.getElementById('syncStatus');
                status.textContent = this.data.hasUnsyncedChanges ? 'Unsaved' : 'Synced';
                status.className = this.data.hasUnsyncedChanges ? 'sync-status pending' : 'sync-status';
            },
            
            // loadMoreTasks - REMOVED: All tasks now show by default
            // No pagination needed!
            
            generateTODOMarkdown() {
                let md = '# SARAH\'S PERMANENT TO-DO LIST\n\n**Always updated**\n';
                md += `**Last updated:** ${new Date().toLocaleDateString()}\n\n---\n\n`;
                this.data.sections.forEach(section => {
                    md += `## ${section.title}\n\n`;
                    section.tasks.forEach(task => {
                        md += `- ${task.completed ? '[x]' : '[ ]'} ${task.text}\n`;
                        // Add subtasks with proper indentation
                        if (task.subtasks && task.subtasks.length > 0) {
                            task.subtasks.forEach(sub => {
                                md += `  - ${sub.completed ? '[x]' : '[ ]'} ${sub.text}\n`;
                            });
                        }
                    });
                    md += '\n';
                });
                return md;
            },
            
            render() {
                const container = document.getElementById('sections');
                container.innerHTML = '';
                this.data.sections.forEach(section => {
                    const completed = section.tasks.filter(t => t.completed).length;
                    const total = section.tasks.length;
                    // SHOW ALL TASKS - NO PAGINATION!
                    const visibleTasks = section.tasks;
                    
                    const tasksHTML = visibleTasks.map(task => {
                        const subtasksHTML = task.subtasks && task.subtasks.length > 0 ? `
                            <div class="subtasks">
                                ${task.subtasks.map((sub, idx) => `
                                    <div class="subtask ${sub.completed ? 'completed' : ''}">
                                        <input type="checkbox" ${sub.completed ? 'checked' : ''} 
                                            onchange="app.toggleSubtask('${section.id}', ${task.id}, ${idx})">
                                        <div class="subtask-text">${sub.text}</div>
                                        <button class="btn-edit-sub" onclick="app.editSubtask('${section.id}', ${task.id}, ${idx})" title="Edit subtask">‚úèÔ∏è</button>
                                        <button class="btn-delete-sub" onclick="app.deleteSubtask('${section.id}', ${task.id}, ${idx})" title="Delete subtask">‚úï</button>
                                    </div>
                                `).join('')}
                            </div>
                        ` : '';
                        
                        return `
                            <div class="task ${task.completed ? 'completed' : ''}">
                                <input type="checkbox" ${task.completed ? 'checked' : ''} onchange="app.toggleTask('${section.id}', ${task.id})">
                                <div class="task-text">${task.text}</div>
                                <button class="btn-add-subtask" onclick="app.showAddSubtask('${section.id}', ${task.id})" title="Add subtask">+</button>
                                <button class="btn-edit" onclick="app.editTask('${section.id}', ${task.id})" title="Edit task">‚úèÔ∏è</button>
                                <button class="btn-delete" onclick="app.deleteTask('${section.id}', ${task.id})" title="Delete task">üóëÔ∏è</button>
                                ${subtasksHTML}
                            </div>
                        `;
                    }).join('');
                    
                    // NO LOAD MORE - ALL TASKS ALWAYS VISIBLE!
                    
                    const addTaskHTML = !section.collapsed ? `
                        <div class="add-task-row">
                            <button class="btn-add-task" onclick="app.showAddTask('${section.id}')" title="Add new task">+ Add Task</button>
                        </div>
                    ` : '';
                    
                    container.insertAdjacentHTML('beforeend', `
                        <div class="section">
                            <div class="section-header" onclick="app.toggleSection('${section.id}')">
                                <h2>${section.title} <span class="section-badge">${completed}/${total}</span></h2>
                                <span>${section.collapsed ? 'v' : '^'}</span>
                            </div>
                            <div class="section-content ${section.collapsed ? 'collapsed' : ''}">
                                ${tasksHTML}
                                ${addTaskHTML}
                            </div>
                        </div>
                    `);
                });
            },
            
            toggleSection(id) {
                const s = this.data.sections.find(x => x.id === id);
                if (s) { s.collapsed = !s.collapsed; this.saveData(); this.render(); }
            },
            
            collapseAll() { this.data.sections.forEach(s => s.collapsed = true); this.saveData(); this.render(); },
            expandAll() { this.data.sections.forEach(s => s.collapsed = false); this.saveData(); this.render(); },
            
            async toggleTask(sid, tid) {
                const s = this.data.sections.find(x => x.id === sid);
                const t = s.tasks.find(x => x.id === tid);
                this.data.history.push({ type: 'toggle', sid, tid, prev: t.completed });
                t.completed = !t.completed;
                await this.saveData();
                this.render();
                this.updateStats();
                this.showToast(t.completed ? 'Done!' : 'Undone');
            },
            
            async undo() {
                if (this.data.history.length === 0) { this.showToast('Nothing to undo'); return; }
                const a = this.data.history.pop();
                const s = this.data.sections.find(x => x.id === a.sid);
                if (a.type === 'toggle') { const t = s.tasks.find(x => x.id === a.tid); t.completed = a.prev; }
                await this.saveData();
                this.render();
                this.updateStats();
                this.showToast('Undone!');
            },
            
            async deleteTask(sid, tid) {
                if (!confirm('Delete this task?')) return;
                const s = this.data.sections.find(x => x.id === sid);
                const taskIndex = s.tasks.findIndex(x => x.id === tid);
                if (taskIndex > -1) {
                    s.tasks.splice(taskIndex, 1);
                    this.data.hasUnsyncedChanges = true;
                    await this.saveData();
                    this.render();
                    this.updateStats();
                    this.showToast('Task deleted');
                }
            },
            
            async editTask(sid, tid) {
                const s = this.data.sections.find(x => x.id === sid);
                const task = s.tasks.find(t => t.id === tid);
                const newText = prompt('Edit task:', task.text);
                
                if (newText !== null && newText.trim() && newText.trim() !== task.text) {
                    task.text = newText.trim();
                    this.data.hasUnsyncedChanges = true;
                    await this.saveData();
                    this.render();
                    this.showToast('Task updated');
                }
            },
            
            async editSubtask(sid, tid, subIdx) {
                const s = this.data.sections.find(x => x.id === sid);
                const task = s.tasks.find(t => t.id === tid);
                const subtask = task.subtasks[subIdx];
                const newText = prompt('Edit subtask:', subtask.text);
                
                if (newText !== null && newText.trim() && newText.trim() !== subtask.text) {
                    subtask.text = newText.trim();
                    this.data.hasUnsyncedChanges = true;
                    await this.saveData();
                    this.render();
                    this.showToast('‚úèÔ∏è Subtask updated!');
                }
            },
            
            showAddTask(sid) {
                const taskText = prompt('Enter new task:');
                if (!taskText || !taskText.trim()) return;
                
                const s = this.data.sections.find(x => x.id === sid);
                const maxId = Math.max(0, ...this.data.sections.flatMap(sec => sec.tasks.map(t => t.id)));
                const newTask = {
                    id: maxId + 1,
                    text: taskText.trim(),
                    completed: false,
                    subtasks: []
                };
                
                s.tasks.push(newTask);
                this.data.hasUnsyncedChanges = true;
                this.saveData();
                this.render();
                this.updateStats();
                this.showToast('Task added!');
            },
            
            showAddSubtask(sid, tid) {
                const subtaskText = prompt('Enter subtask:');
                if (!subtaskText || !subtaskText.trim()) return;
                
                const s = this.data.sections.find(x => x.id === sid);
                const task = s.tasks.find(t => t.id === tid);
                
                if (!task.subtasks) task.subtasks = [];
                
                task.subtasks.push({
                    text: subtaskText.trim(),
                    completed: false
                });
                
                this.data.hasUnsyncedChanges = true;
                this.saveData();
                this.render();
                this.showToast('Subtask added!');
            },
            
            async toggleSubtask(sid, tid, subIdx) {
                const s = this.data.sections.find(x => x.id === sid);
                const task = s.tasks.find(t => t.id === tid);
                task.subtasks[subIdx].completed = !task.subtasks[subIdx].completed;
                
                await this.saveData();
                this.render();
                this.updateStats();
                this.showToast(task.subtasks[subIdx].completed ? 'Done!' : 'Undone');
            },
            
            async deleteSubtask(sid, tid, subIdx) {
                if (!confirm('Delete this subtask?')) return;
                const s = this.data.sections.find(x => x.id === sid);
                const task = s.tasks.find(t => t.id === tid);
                task.subtasks.splice(subIdx, 1);
                
                this.data.hasUnsyncedChanges = true;
                await this.saveData();
                this.render();
                this.updateStats();
                this.showToast('Subtask deleted');
            },
            
            async clearCompleted() {
                if (!confirm('Remove all completed tasks?')) return;
                this.data.sections.forEach(s => { s.tasks = s.tasks.filter(t => !t.completed); });
                await this.saveData();
                this.render();
                this.updateStats();
                this.showToast('Cleared!');
            },
            
            updateStats() {
                const all = this.data.sections.flatMap(s => s.tasks);
                const done = all.filter(t => t.completed).length;
                const total = all.length;
                const pct = total > 0 ? Math.round((done / total) * 100) : 0;
                document.getElementById('totalTasks').textContent = total;
                document.getElementById('completedTasks').textContent = done;
                document.getElementById('remainingTasks').textContent = total - done;
                document.getElementById('progressPercent').textContent = pct + '%';
            },
            
            showToast(msg) {
                const t = document.getElementById('toast');
                t.textContent = msg;
                t.classList.add('active');
                setTimeout(() => t.classList.remove('active'), 2500);
            }
        };
        
        window.addEventListener('DOMContentLoaded', () => app.init());
    </script>
</body>
</html>
