<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sarah's TODO - ADHD Friendly</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Arial, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            padding: 20px;
            min-height: 100vh;
        }
        
        .container {
            max-width: 800px;
            margin: 0 auto;
            background: white;
            border-radius: 12px;
            box-shadow: 0 10px 40px rgba(0,0,0,0.2);
            overflow: hidden;
        }
        
        .header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 30px 20px;
            text-align: center;
        }
        
        .header h1 { font-size: 2em; margin-bottom: 5px; }
        .header p { opacity: 0.9; font-size: 0.9em; }
        
        .sync-bar {
            background: #f7fafc;
            padding: 15px 20px;
            border-bottom: 1px solid #e2e8f0;
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }
        
        .btn-sync {
            flex: 1;
            min-width: 120px;
            padding: 10px 20px;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.2s;
        }
        
        .btn-pull {
            background: #48bb78;
            color: white;
        }
        
        .btn-pull:hover { background: #38a169; }
        
        .btn-push {
            background: #4299e1;
            color: white;
        }
        
        .btn-push:hover { background: #3182ce; }
        
        .content {
            padding: 20px;
            max-height: calc(100vh - 300px);
            overflow-y: auto;
        }
        
        .section {
            margin-bottom: 25px;
            border: 1px solid #e2e8f0;
            border-radius: 8px;
            overflow: hidden;
        }
        
        .section-header {
            background: #f7fafc;
            padding: 15px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            cursor: pointer;
            border-bottom: 1px solid #e2e8f0;
        }
        
        .section-header:hover { background: #edf2f7; }
        
        .section-title {
            font-weight: 600;
            font-size: 1.1em;
            color: #2d3748;
        }
        
        .section-count {
            background: #667eea;
            color: white;
            padding: 4px 12px;
            border-radius: 12px;
            font-size: 0.85em;
            font-weight: 600;
        }
        
        .section-tasks {
            padding: 15px;
        }
        
        .section.collapsed .section-tasks {
            display: none;
        }
        
        .task {
            display: flex;
            align-items: flex-start;
            gap: 10px;
            padding: 12px;
            margin-bottom: 10px;
            background: white;
            border: 1px solid #e2e8f0;
            border-radius: 6px;
        }
        
        .task:hover { background: #f7fafc; }
        
        .task input[type="checkbox"] {
            width: 20px;
            height: 20px;
            cursor: pointer;
            margin-top: 2px;
            flex-shrink: 0;
        }
        
        .task-text {
            flex: 1;
            line-height: 1.5;
            color: #2d3748;
            word-wrap: break-word;
            min-width: 0;
        }
        
        .task.completed .task-text {
            text-decoration: line-through;
            color: #a0aec0;
        }
        
        .task-actions {
            display: flex;
            gap: 4px;
            flex-shrink: 0;
        }
        
        .btn-icon {
            background: none;
            border: none;
            cursor: pointer;
            font-size: 1.2em;
            padding: 4px 8px;
            border-radius: 4px;
            transition: all 0.2s;
        }
        
        .btn-add { color: #48bb78; }
        .btn-add:hover { background: #e6fffa; }
        
        .btn-edit { color: #4299e1; }
        .btn-edit:hover { background: #ebf8ff; }
        
        .btn-delete { color: #f56565; }
        .btn-delete:hover { background: #fed7d7; }
        
        /* SUBTASKS STYLING */
        .subtasks {
            margin: 10px 0 0 30px;
            padding: 10px;
            background: #f7fafc;
            border-left: 3px solid #9f7aea;
            border-radius: 0 6px 6px 0;
        }
        
        .subtask {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 8px;
            margin: 6px 0;
            background: white;
            border: 1px solid #e2e8f0;
            border-radius: 4px;
        }
        
        .subtask input[type="checkbox"] {
            width: 18px;
            height: 18px;
            cursor: pointer;
            flex-shrink: 0;
        }
        
        .subtask-text {
            flex: 1;
            font-size: 0.92em;
            color: #2d3748;
            line-height: 1.4;
            word-wrap: break-word;
            min-width: 0;
        }
        
        .subtask.completed .subtask-text {
            text-decoration: line-through;
            color: #a0aec0;
        }
        
        .toast {
            position: fixed;
            bottom: 20px;
            right: 20px;
            background: #2d3748;
            color: white;
            padding: 15px 20px;
            border-radius: 8px;
            opacity: 0;
            transition: opacity 0.3s;
            z-index: 1000;
        }
        
        .toast.active { opacity: 1; }
        
        .btn-add-task {
            width: 100%;
            padding: 12px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            border-radius: 6px;
            font-weight: 600;
            cursor: pointer;
            margin-top: 10px;
        }
        
        .btn-add-task:hover { opacity: 0.9; }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>Sarah's TODO</h1>
            <p>ADHD-Friendly Task Manager</p>
        </div>
        
        <div class="sync-bar">
            <button class="btn-sync btn-pull" onclick="app.pullFromGitHub()">‚¨á Pull Latest</button>
            <button class="btn-sync btn-push" onclick="app.pushToGitHub()">‚¨Ü Save Changes</button>
        </div>
        
        <div class="content" id="sections"></div>
    </div>
    
    <div class="toast" id="toast"></div>
    
    <script>
        const GITHUB_TOKEN = localStorage.getItem('github_token') || '';
        const GITHUB_REPO = 'MotherOfChaos/Life-Operating-System';
        const GITHUB_FILE = 'PERMANENT_TODO.md';
        
        const app = {
            data: { sections: [], lastSHA: null },
            
            async init() {
                await this.loadFromLocalStorage();
                this.render();
            },
            
            async loadFromLocalStorage() {
                const saved = localStorage.getItem('todoData');
                if (saved) {
                    this.data = JSON.parse(saved);
                }
            },
            
            async saveToLocalStorage() {
                localStorage.setItem('todoData', JSON.stringify(this.data));
            },
            
            async pullFromGitHub() {
                this.showToast('Pulling from GitHub...');
                try {
                    const url = `https://api.github.com/repos/${GITHUB_REPO}/contents/${GITHUB_FILE}`;
                    const response = await fetch(url, {
                        headers: {
                            'Authorization': `token ${GITHUB_TOKEN}`,
                            'Accept': 'application/vnd.github.v3.raw'
                        }
                    });
                    
                    if (!response.ok) throw new Error('Pull failed');
                    
                    const markdown = await response.text();
                    const shaSEOF
echo "Part 1 created..."response = await fetch(url, { headers: { 'Authorization': `token ${GITHUB_TOKEN}` }});
                    const data = await response.json();
                    this.data.lastSHA = data.sha;
                    
                    this.data.sections = this.parseMarkdown(markdown);
                    await this.saveToLocalStorage();
                    this.render();
                    this.showToast('‚úÖ Pulled from GitHub!');
                } catch (error) {
                    this.showToast('‚ùå Pull failed');
                    console.error(error);
                }
            },
            
            async pushToGitHub() {
                this.showToast('Pushing to GitHub...');
                try {
                    if (!this.data.lastSHA) {
                        const url = `https://api.github.com/repos/${GITHUB_REPO}/contents/${GITHUB_FILE}`;
                        const response = await fetch(url, {
                            headers: { 'Authorization': `token ${GITHUB_TOKEN}` }
                        });
                        const data = await response.json();
                        this.data.lastSHA = data.sha;
                    }
                    
                    const markdown = this.generateMarkdown();
                    const content = btoa(unescape(encodeURIComponent(markdown)));
                    
                    const url = `https://api.github.com/repos/${GITHUB_REPO}/contents/${GITHUB_FILE}`;
                    const response = await fetch(url, {
                        method: 'PUT',
                        headers: {
                            'Authorization': `token ${GITHUB_TOKEN}`,
                            'Content-Type': 'application/json'
                        },
                        body: JSON.stringify({
                            message: `TODO update - ${new Date().toLocaleString()}`,
                            content: content,
                            sha: this.data.lastSHA
                        })
                    });
                    
                    if (!response.ok) throw new Error('Push failed');
                    
                    const data = await response.json();
                    this.data.lastSHA = data.content.sha;
                    await this.saveToLocalStorage();
                    this.showToast('‚úÖ Saved to GitHub!');
                } catch (error) {
                    this.showToast('‚ùå Save failed');
                    console.error(error);
                }
            },
            
            parseMarkdown(md) {
                const sections = [];
                const lines = md.split('\n');
                let currentSection = null;
                let currentTask = null;
                let taskId = 1;
                
                for (let line of lines) {
                    const trimmed = line.trim();
                    
                    if (trimmed.startsWith('## ')) {
                        if (currentSection && currentSection.tasks.length > 0) {
                            sections.push(currentSection);
                        }
                        currentSection = {
                            id: 'section-' + sections.length,
                            title: trimmed.substring(3).trim(),
                            collapsed: false,
                            tasks: []
                        };
                        currentTask = null;
                    }
                    else if (trimmed.match(/^- \[(x| )\] /) && currentSection) {
                        const completed = trimmed.includes('[x]');
                        const text = trimmed.substring(6).trim();
                        currentTask = {
                            id: taskId++,
                            text: text,
                            completed: completed,
                            subtasks: []
                        };
                        currentSection.tasks.push(currentTask);
                    }
                    else if (line.match(/^  +- \[(x| )\] /) && currentTask) {
                        const completed = trimmed.includes('[x]');
                        const text = trimmed.substring(6).trim();
                        currentTask.subtasks.push({
                            id: taskId++,
                            text: text,
                            completed: completed
                        });
                    }
                }
                
                if (currentSection && currentSection.tasks.length > 0) {
                    sections.push(currentSection);
                }
                
                return sections;
            },
            
            generateMarkdown() {
                let md = '# SARAH\'S PERMANENT TO-DO LIST\n\n';
                md += '**Always updated**\n';
                md += `**Last updated:** ${new Date().toLocaleDateString()}\n\n---\n\n`;
                
                this.data.sections.forEach(section => {
                    md += `## ${section.title}\n\n`;
                    section.tasks.forEach(task => {
                        md += `- ${task.completed ? '[x]' : '[ ]'} ${task.text}\n`;
                        if (task.subtasks && task.subtasks.length > 0) {
                            task.subtasks.forEach(sub => {
                                md += `  - ${sub.completed ? '[x]' : '[ ]'} ${sub.text}\n`;
                            });
                        }
                    });
                    md += '\n';
                });
                
                return md;
            },
            
            render() {
                const container = document.getElementById('sections');
                container.innerHTML = '';
                
                this.data.sections.forEach(section => {
                    const sectionDiv = document.createElement('div');
                    sectionDiv.className = 'section' + (section.collapsed ? ' collapsed' : '');
                    
                    const completed = section.tasks.filter(t => t.completed).length;
                    const total = section.tasks.length;
                    
                    sectionDiv.innerHTML = `
                        <div class="section-header" onclick="app.toggleSection('${section.id}')">
                            <div class="section-title">${section.title}</div>
                            <div class="section-count">${completed}/${total}</div>
                        </div>
                        <div class="section-tasks">
                            ${section.tasks.map(task => this.renderTask(section.id, task)).join('')}
                            <button class="btn-add-task" onclick="app.addTask('${section.id}')">+ Add Task</button>
                        </div>
                    `;
                    
                    container.appendChild(sectionDiv);
                });
            },
            
            renderTask(sectionId, task) {
                let html = `
                    <div class="task ${task.completed ? 'completed' : ''}">
                        <input type="checkbox" ${task.completed ? 'checked' : ''} 
                            onchange="app.toggleTask('${sectionId}', ${task.id})">
                        <div class="task-text">${task.text}</div>
                        <div class="task-actions">
                            <button class="btn-icon btn-add" onclick="app.addSubtask('${sectionId}', ${task.id})" title="Add subtask">+</button>
                            <button class="btn-icon btn-edit" onclick="app.editTask('${sectionId}', ${task.id})" title="Edit">‚úèÔ∏è</button>
                            <button class="btn-icon btn-delete" onclick="app.deleteTask('${sectionId}', ${task.id})" title="Delete">üóëÔ∏è</button>
                        </div>
                    </div>
                `;
                
                if (task.subtasks && task.subtasks.length > 0) {
                    html += '<div class="subtasks">';
                    task.subtasks.forEach((sub, idx) => {
                        html += `
                            <div class="subtask ${sub.completed ? 'completed' : ''}">
                                <input type="checkbox" ${sub.completed ? 'checked' : ''}
                                    onchange="app.toggleSubtask('${sectionId}', ${task.id}, ${idx})">
                                <div class="subtask-text">${sub.text}</div>
                                <div class="task-actions">
                                    <button class="btn-icon btn-edit" onclick="app.editSubtask('${sectionId}', ${task.id}, ${idx})" title="Edit">‚úèÔ∏è</button>
                                    <button class="btn-icon btn-delete" onclick="app.deleteSubtask('${sectionId}', ${task.id}, ${idx})" title="Delete">‚úï</button>
                                </div>
                            </div>
                        `;
                    });
                    html += '</div>';
                }
                
                return html;
            },
            
            toggleSection(sectionId) {
                const section = this.data.sections.find(s => s.id === sectionId);
                section.collapsed = !section.collapsed;
                this.render();
            },
            
            async toggleTask(sectionId, taskId) {
                const section = this.data.sections.find(s => s.id === sectionId);
                const task = section.tasks.find(t => t.id === taskId);
                task.completed = !task.completed;
                await this.saveToLocalStorage();
                this.render();
            },
            
            async toggleSubtask(sectionId, taskId, subIdx) {
                const section = this.data.sections.find(s => s.id === sectionId);
                const task = section.tasks.find(t => t.id === taskId);
                task.subtasks[subIdx].completed = !task.subtasks[subIdx].completed;
                await this.saveToLocalStorage();
                this.render();
            },
            
            async addTask(sectionId) {
                const text = prompt('New task:');
                if (!text || !text.trim()) return;
                
                const section = this.data.sections.find(s => s.id === sectionId);
                const maxId = section.tasks.length > 0 ? Math.max(...section.tasks.map(t => t.id)) : 0;
                section.tasks.push({
                    id: maxId + 1,
                    text: text.trim(),
                    completed: false,
                    subtasks: []
                });
                await this.saveToLocalStorage();
                this.render();
                this.showToast('‚úÖ Task added!');
            },
            
            async addSubtask(sectionId, taskId) {
                const text = prompt('New subtask:');
                if (!text || !text.trim()) return;
                
                const section = this.data.sections.find(s => s.id === sectionId);
                const task = section.tasks.find(t => t.id === taskId);
                const maxId = task.subtasks.length > 0 ? Math.max(...task.subtasks.map(s => s.id)) : taskId * 100;
                task.subtasks.push({
                    id: maxId + 1,
                    text: text.trim(),
                    completed: false
                });
                await this.saveToLocalStorage();
                this.render();
                this.showToast('‚úÖ Subtask added!');
            },
            
            async editTask(sectionId, taskId) {
                const section = this.data.sections.find(s => s.id === sectionId);
                const task = section.tasks.find(t => t.id === taskId);
                const newText = prompt('Edit task:', task.text);
                if (newText && newText.trim() && newText.trim() !== task.text) {
                    task.text = newText.trim();
                    await this.saveToLocalStorage();
                    this.render();
                    this.showToast('‚úÖ Task updated!');
                }
            },
            
            async editSubtask(sectionId, taskId, subIdx) {
                const section = this.data.sections.find(s => s.id === sectionId);
                const task = section.tasks.find(t => t.id === taskId);
                const subtask = task.subtasks[subIdx];
                const newText = prompt('Edit subtask:', subtask.text);
                if (newText && newText.trim() && newText.trim() !== subtask.text) {
                    subtask.text = newText.trim();
                    await this.saveToLocalStorage();
                    this.render();
                    this.showToast('‚úÖ Subtask updated!');
                }
            },
            
            async deleteTask(sectionId, taskId) {
                if (!confirm('Delete this task?')) return;
                const section = this.data.sections.find(s => s.id === sectionId);
                section.tasks = section.tasks.filter(t => t.id !== taskId);
                await this.saveToLocalStorage();
                this.render();
                this.showToast('üóëÔ∏è Task deleted');
            },
            
            async deleteSubtask(sectionId, taskId, subIdx) {
                if (!confirm('Delete this subtask?')) return;
                const section = this.data.sections.find(s => s.id === sectionId);
                const task = section.tasks.find(t => t.id === taskId);
                task.subtasks.splice(subIdx, 1);
                await this.saveToLocalStorage();
                this.render();
                this.showToast('üóëÔ∏è Subtask deleted');
            },
            
            showToast(message) {
                const toast = document.getElementById('toast');
                toast.textContent = message;
                toast.classList.add('active');
                setTimeout(() => toast.classList.remove('active'), 3000);
            }
        };
        
        window.addEventListener('DOMContentLoaded', () => app.init());
    </script>
</body>
</html>
